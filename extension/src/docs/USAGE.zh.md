# excelMerge（插件）使用说明

最后更新：2026-02-05

## 1. 适用场景

- 多份 Excel/CSV 导出表，字段名不一致（同义列：手机号/Phone/电话）
- 需要统一字段后导出一份“标准表”
- 需要按主键把多表合并到同一行（Join），或仅纵向追加（Append）

## 2. 隐私与数据流

- 文件数据在本地读取、合并与导出
- 发送到服务端用于智能分析的仅包含：文件名 + 表头（headers）

## 3. 快速开始（4 步）

1) 官网首页：点击“开始免费使用”进入文件处理页。
2) 上传：拖入 .xlsx / .csv 文件（MVP：仅处理第一张 Sheet）。
3) 确认表头行：每个文件可以选择“表头行”（从 1 开始）。如果你的文件上方有标题/说明行，把表头行调到真正字段所在行。
4) 智能分析与映射：点击按钮生成统一字段，并在右侧表格中手动校正映射。

## 4. AI 智能清洗 (New)

- **AI 辅助清洗 (Beta)**：在处理页下方输入框输入清洗指令（如“识别手机号所属运营商并新增一列”、“将所有金额转换为人民币”等）。
- **自动化转换**：系统会自动理解指令并更新 Schema。在导出时，程序会根据 AI 注入的逻辑自动填充数据（例如：自动识别中国移动/联通/电信）。
- **自定义 Toast**：所有 AI 处理结果和系统提示均采用统一的深色主题 UI，支持长文本自动换行与居中显示。

## 4. 字段映射（Mapping）

- 右侧表格第一列是“统一字段名”（unified schema）
- 每个文件对应一列，单元格显示该文件中被映射到该统一字段的原始列名
- 点击任意单元格可以修改映射；选择“未映射”表示该文件没有这个字段

## 5. 导出（Append / Join）

### 5.1 追加合并（Append）

- 纵向拼接：把所有文件的行追加到一张表
- 导出文件名：cleaned_data_append.xlsx
- 每行都会附带 `_source_file` 标记来源文件

### 5.2 按主键合并（Join）

- 横向合并：按你选择的“主键字段”把多表合并为“一行一条记录”
- 选择主键：在导出区切换为“按主键合并”，并选择一个主键字段（例如 customer_id / phone_number / serial_number）
- 导出文件名：cleaned_data_join.xlsx
- 每行都会附带 `_source_files` 标记合并来源文件
- 如果某个文件没有把该主键字段映射到任何原始列，会提示并禁止导出（避免得到空结果）

## 6. 常见问题

### 6.1 表头不在第一行怎么办？

- 在文件卡片中把“表头行”调整到真正字段行（从 1 开始）
- 调整后会自动重新解析，并清空旧映射（避免错位）

### 6.2 为什么按钮点了没反应/分析失败？

- 确认后端服务可访问（开发默认：http://localhost:3000；生产可通过 VITE_API_BASE 配置服务域名）
- 如果你配置了 DEEPSEEK_API_KEY，会优先走模型；如果调用失败会自动降级为规则映射，仍可使用

### 6.3 Join 合并后同一个 key 有多行，怎么处理？

- 当前策略是“先到先得 + 后到补空”：已有值不覆盖，后续文件只补空字段
- 如需自定义冲突策略（覆盖/拼接/取最新），可以在下一版增加选项

## 7. 版本更新要求（重要）

- 每次功能变动（新增字段、导出规则、UI 交互变化）必须同步更新本说明
- 本说明文件路径：extension/src/docs/USAGE.zh.md

## 8. 后台统计与用户反馈

### 8.1 后台数据面板

- 打开：后端域名 + /admin（开发默认：http://localhost:3000/admin）
- 若配置了 ADMIN_TOKEN，需要访问 /admin?token=... 或在请求里带 x-admin-token
- 支持按天 / 按周 / 按月查看：
  - 活跃用户（去重 clientId）
  - 上传次数、分析成功/失败、导出次数（Join/Append）
  - 最新反馈与评分分布

### 8.2 评价与建议

- 插件右上角有“评价建议”入口，可填写评分与建议文本
- 提交后会写入服务端本地 data/ 目录（仅用于产品迭代分析）
